# Assignment by Basil Burri
These questions are designed to test your understanding of the sequence analysis practical and the accompanying literature.
These questions will be graded. The most important thing is not that you get everything right, but that you show that you thought about the questions; so no copy/pasting!

## Practical

### Q1
**Does the sequence quality graph of your data look different from the examples shown in the slides? Are there any adapter sequences in the data? Why do you think this is?**

The sequence quality graph does not show any quality scores for the reads, assuming all sequences have the same non-assigned quality. This makes sense because the simulated data was specifically designed without quality scores. Inlcuding quality scores would simulate more real-world data. There are also no adapter sequences in the data, as adapters are used during actual sequencing, and there was no need to include adapter sequences in this simulated dataset.

### Q2
**Given the FastQC reports, does it make sense to perform adapter and/or quality-trimming on your data?**

The absence of quality scores and adapter sequences means that no quality or adapter trimming is needed in this exercise. The sequence quality graph and the average sequence length therefore do not change, as no trimming will be performed. In a real-world sequencing experiment, one would have to remove reads with lower quality and cut away adapter sequences. This would generally lead to fewer reads (but increased average quality) and shorter reads.

### Q3
**Why are so many files in the bioinformatics pipeline compressed and indexed?**

Bioinformatics files like FASTA or SAM are large, as they are text-based formats. Compressed formats like FASTA.gz (compressed FASTA) or BAM (binary, compressed version of SAM) save storage space. Indexing, such as with ``samtools faidx`` for FASTA or using BAI indexing with ``samtools view`` for BAM, enables more efficient querying of specific genomic regions without reading the entire file. This "random access" facilitates faster processing in tools analyzing large datasets. In our exercise, GangSTR requires the reference genome to have an index generated by ``samtools`` to allow rapid access to tandem repeat regions.

### Q4
**In the bash script that processes alignment files, you will see calls to samtools sort, samtools view, and samtools index (among others). Explain what these three programs do. Why do you think each program is needed?**
*Hint: look at the [Samtools manual](http://www.htslib.org/doc/samtools.html)*.

1. ``samtools sort`` sorts alignments by the leftmost coordinates. By specifying options, other sort orders are possible (e.g. -n: sorted by read name, -t: sorted by tag). In our exercise, we used the default options to sort alignments by the leftmost coordinates, which is necessary for indexing.

2. ``samtools view`` prints all alignments in the specified input alignment file to standard output in SAM format. By specifying options, the command can convert the output from SAM to BAM or CRAM (--bam: convert to BAM, --cram: convert to CRAM). In our exercise, we used the option ``--bam`` to compress the alignments into the BAM format.

3. ``samtools index`` indexes a coordinate-sorted BAM or CRAM file for fast random access. BAM and CRAM files use BGZF compression and indexing creates a BAI file to support region-specific queries. Indices are needed when arguments limit ``samtools view`` or similar commands to particular regions of interest. In our exercise, after converting the SAM file to BAM with ``samtools view --bam``, we used ``samtools index`` to index the alignments, to allow random data access for GangSTR.

### Q5
**Explain what files are needed for GangSTR to run. Specifically: explain what information is provided to GangSTR via the --ref, --regions, and --bam command line arguments.**
*Hint: look at the [GangSTR manual](https://github.com/gymreklab/gangstr).*

**Needed files for GangSTR**

GangSTR requires a BAM file of short read alignments, a reference set of TRs, and a reference genome, and outputs genotypes in a VCF file.

| File Type                     | Purpose                                                  | Notes                                                                 |
|-------------------------------|----------------------------------------------------------|----------------------------------------------------------------------|
| BAM file                      | Contains short read alignments for a sample              | Produced by an indel-sensitive aligner, must be sorted and indexed.   |
| FASTA reference genome        | Reference genome used for alignment and genotyping       | Must be the same reference build used to align the sequences in the BAM file to prevent alignment errors or misgenotyping, especially for repetitive STR regions. |
| BED-like TR regions file      | Defines regions of tandem repeats (TRs) to be genotyped  | BED-like file with columns: Chromosome name, start position, end position, motif length, repeat motif. |

**Information provided to GangSTR by options**

| Argument     | File Type                 | Description                                                                        |
|--------------|---------------------------|------------------------------------------------------------------------------------|
| `--bam`      | BAM file                  | Specifies the input short read alignment file. One sample per file. Must be sorted and indexed. |
| `--ref`      | FASTA reference genome    | Specifies the reference genome used for aligning reads and genotyping. Must match the BAM's reference. | 
| `--regions`  | BED-like TR regions file  | Specifies the tandem repeat regions to analyze. Each entry defines a repeat region to genotype. |

## Literature
During the practical so far, you have generated variant calls from short read sequencing data using bioinformatics approaches. Now it's time to take a step back and do some background reading in order to prepare for the analysis and interpretation of the results next week.

First, read the following sections of [this review](https://www.sciencedirect.com/science/article/pii/S0959437X16301538):
* Abstract
* Introduction
* Genotyping STRs from high-throughput sequencing data

### Q6
**Why is STR variation relevant to health and disease?**

- STRs are multiallelic and contribute more de novo mutations than any other variant class. The high mutation rate is due to their repetitive nature, which induces slippage events during DNA replication. Many repeat disorders follow autosomal dominant inheritance patterns, but as STRs lead to de novo mutations in every new generation and are often multiallelic, they may lead to complex, non-Mendelian inheritance patterns.
- STRs also play a role in regulating gene expression and other molecular phenotypes. STRs modulate gene expression and function in health and disease by forming transcription factor binding sites, affecting spacing between regulatory elements, inducing unusual DNA secondary structures such as Z-DNA, or modulating epigenetic properties such as DNA methylation and heterochromatinization. STRs may also mediate effects at the RNA and protein level by modulating alternative splicing through RNA secondary structure, affecting RNA protein binding sites, or forming toxic RNA and protein aggregates.

[Illustration of the modulations by STRs](https://ars.els-cdn.com/content/image/1-s2.0-S0959437X16301538-gr1_lrg.jpg)

### Q7
**What are some of the challenges in analysing STRs from NGS data?**

1. **PCR-induced stutter:** PCR amplification introduces "stutter" artifacts, causing variations in the number of repeats in sequencing reads, which complicates genotyping.
2. **Local sequence alignment:** Standard alignment tools struggle with repeats, leading to inconsistent alignments due to multiple possible best alignments of short reads that do not capture the entire repeat.
3. **Low-quality calls:** STRs are often filtered out from sequencing pipelines due to unreliable genotyping. Therefore they are often not included in analyses like variant calling or GWAS.
4. **High mutation rates and multiallelic nature of STRs:** STRs cause high mutation rates due to polymerase slippage during replication, and their multiallelic nature creates complex, non-Mendelian inheritance patterns. This nature of STRs makes them difficult to analyze with traditional linkage or bi-allelic SNP-based methods.

Second, read the following sections of the [paper describing GangSTR](https://academic.oup.com/nar/article/47/15/e90/5518310):
* Abstract
* Introduction
* Overview of the GangSTR model

### Q8
**What sets GangSTR apart from other STR genotyping tools?**

GangSTR performes better in genome-wide STR genotyping using NGS data compared to tools like LobSTR, HipSTR, ExpansionHunter, Tredparse, exSTRa, and STRetch. 

- **Broader genotyping range:** Accurately genotypes short and expanded TRs, including those exceeding read or fragment length, unlike LobSTR and HipSTR (which are limited to short TRs) or ExpansionHunter and Tredparse (which do not work well with long alleles).
- **Integrative model:** Integrates multiple paired-end read properties (enclosing, spanning, flanking, fully repetitive reads, coverage, fragment length) into a maximum likelihood framework, unlike exSTRa (which provides no length estimates) or STRetch (limited to 6 bp motifs).
- **Scalability:** Optimized for genome-wide analysis, unlike Tredparse and ExpansionHunter, which focus on targeted pathogenic expansions.
- **Accuracy and speed:** Outperforms many tools in accuracy and speed for genome-wide STR genotyping, providing unbiased TR length estimates for GWAS and novel variant discovery.
- **Validated discoveries:** Identifies novel TR expansions in healthy individuals, validated by long-read sequencing and capillary electrophoresis, which is not possible with other genome-wide STR genotyping tools like LobSTR and HipSTR.

### Q9
**What types of information does GangSTR use for STR genotyping?**

GangSTR is an end-to-end method that requires sequence alignments and a reference set of TRs as input and outputs estimated diploid repeat lengths. GangSTR uses multiple paired-end short read (from NGS) properties in its maximum likelihood framework, including read depth and allele-specific information to refine genotyping accuracy.

- **Enclosing Reads:** Fully contain TR and flanking regions &rarr; directly counting repeats
- **Spanning Reads:** Span TR, with reads in flanking regions &rarr; informing TR length via fragment size
- **Flanking Reads:** Partially extend into TR &rarr; supporting length estimation
- **Fully Repetitive Reads (FRR):** Consist entirely of the TR motif &rarr; indicating TRs longer than the read length
- **Coverage and Fragment Length:** Incorporates sequencing coverage, read depth, and fragment length distribution &rarr; estimate TR lengths, especially for long alleles

[Illustration of the different read properties](https://academic.oup.com/view-large/figure/140580719/gkz501fig1.jpg)
